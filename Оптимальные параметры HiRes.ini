Оптимальные параметры HiRes.fix

Для реалистичных портретов рекомендуется использовать не-латентные апскейлеры (GAN-модели) вместо стандартного латентного. Например, апскейлеры 4x-UltraSharp или R-ESRGAN 4x+ дают лучшие результаты с сохранением деталей  . Латентный апскейлер требует высокого denoise (~0.5–0.7), иначе изображения выходят размытыми  , и к тому же при Flux он часто искажает тонкие детали. Напротив, при использовании GAN-апскейлера можно выбрать низкий уровень денойзинга (~0.3–0.5) – это позволит сохранить исходную композицию и детали  .

Рекомендации:
 • Апскейлер: 4x-UltraSharp, R-ESRGAN 4x+, SwinIR 4x, ScuNET GAN и др. (в A1111 доступны ESRGAN, GFPGAN и т.п.)  . Например, один опыт рекомендовал 4x-UltraSharp (масштаб 2×) с денойзом ~0.4 .
 • Шаги: исходная генерация ~20–30 шагов, для HiRes.fix – ~10–25 шагов. Во многих рекомендациях HiRes-шаги ставят в том же диапазоне или чуть больше исходных  . Слишком большое значение шагов (>25) существенно замедляет генерацию, но не гарантирует лучшего качества .
 • Denoising strength: для GAN-апскейлеров – около 0.3–0.5. Один пользователь писал: «если исходное изображение размывается, значит denoise слишком высокий. У меня обычно 0.3» . Для латентного апскейлера нужен denoise выше 0.5 (иначе слишком размыто) .
 • Scale factor (увеличение): обычно 2× (например, 512×512→1024×1024). Некоторые используют 1.5× или 2.5×, но 2× считается «стандартом» для портретов (для SD1.5 моделей) . Более сильное увеличение (более 2×) часто приводит к потерям детализации и швам.
 • Метод HiRes.fix: лучше применять HiRes.fix именно с GAN-апскейлером (т.н. «SD Upscale») – этот режим в WebUI позволяет сначала создать картинку, затем апскейлить и доденойзить. Альтернативные методы – Tiled Diffusion (Mixture of Diffusers) или Ultimate SD Upscale – обсуждаются отдельно (см. ниже).

Пример рекомендуемых настроек HiRes.fix:

Параметр Рекомендации Комментарий
Апскейлер 4x-UltraSharp, R-ESRGAN 4x+, SwinIR 4x GAN-модели, дают хорошее качество  
Масштаб 2.0× Обычно 2×, для Flux высокие масштабы приводят к размытости 
HiRes шаги 10–25 10–20 для ускорения, >25 шагов мало влияет на качество 
Denoise (hires) ~0.3–0.5 (GAN) / 0.5–0.7 (Latent) Ниже 0.5 для GAN-апскейлеров (лучше сохранение деталей) ; для латентного ≥0.5 
CFG (stage 2) Равное или чуть ниже CFG исходного (см. ниже про CFG)

Настройки ADetailer

ADetailer автоматически находит лица/руки и восстанавливает детали через инпейтинг. Для портретов важно подобрать модели детекции и параметры маски:
 • Модели детекции: Лучше использовать модели face_yolov8 (small/medium) для лиц и face_mediapipe_full/short для точной локализации черт лица. MediaPipe-версии обычно дают более тонкую разметку (много точек на лице), но хуже находят боковые или маленькие лица . YOLO-модели (face_yolov8s/m/n) находят больше лиц (включая волосы и брови) и хорошо работают на разных ракурсах. Для рук – hand_yolov8s/n, для тел – person_yolov8m. На подбор моделей влияет скорость: модели “medium” точнее, “nano” быстрее .
 • Параметр confidence (порог уверенности): настраивает чувствительность детектора. Например, порог 0.85 означает, что детектируются только лица с уверенностью выше 85% . Обычно достаточно 0.6–0.8, чтобы не пропускать лица и не рисовать ложные блоки.
 • Mask blur (размытие маски): помогает сгладить переходы между инпейнт-областью и остальной картинкой. Если blur=0, на границах маски могут появляться резкие швы . Если blur слишком велик (≈50), то маска «растворяется» и лица могут не детектироваться . Рекомендуется небольшое размытие (примерно 10–15 пикселей)  , чтобы скрыть переходы, но оставить обработанные границы незаметными.
 • Inpaint denoising strength (интенсивность инпейтинга): контролирует, насколько сильно будут изменены детали лица. Высокое значение (~0.8) даёт сильное преобразование (иногда чрезмерное) ; низкое – более мягкое. По умолчанию ставят ~0.4, в некоторых случаях можно поднять до 0.5–0.6 для усиления эффекта. Главное – не передержать (0.8 обычно слишком много) .
 • Другое: Рекомендуется увеличить область инпейтинга до полного размера 1024×1024 (во вкладке Mask) при работе с SDXL/Flux, чтобы доинпейнтить весь контур лица, а не лишь фрагмент . В ADetailer часто оставляют только “Inpaint only masked” (без разворота маски на весь экран). Опция “Face enhancement (GFPGAN)” можно включить для дополнительной резкости после ADetailer, но ADetailer сама по себе уже инпейнтит лицо.

Итого, рекомендуемые настройки ADetailer для портрета: face_yolov8 (или mediapipe_face) с confidence ~0.7, inpaint denoise ~0.4–0.5, mask blur ~10–15, padding (отступ маски) обычно 10–20 пикс. Например: «mask blur = 12», «inpaint denoise = 0.45»。  .

Общие настройки Forge
 • CFG scale: Для Flux Dev (distilled-модель) обычно используется очень низкое CFG (~1) вместе с «Distilled CFG Guidance» . В обычных моделях SD1.5 CFG ≈7–9. Для Flux Dev в настройках Forge есть параметр Distilled CFG, по умолчанию =3.5, а обычный CFG =1 (при этом отключается негативный промпт) . То есть следует установить CFG=1 и Distilled CFG≈3.5 (или близко к нему).
 • Sampler: Рекомендуется DPM++ 2M Karras или UniPC (оба хорошо работают с Flux/SD1.5). DPM++ 2M Karras — стандартный выбор для реализма (используется во многих примерах) . Компоненты Karras улучшают качество и скорость. DPM++ SDE Karras тоже подходит. Можно экспериментировать с другими методами (Euler A, Euler D, DDIM и др.), но большинство пользователей Flux советуют DPM++ 2M Karras  .
 • Steps: Обычно 20–30 шагов для генерации изображения (SD1.5). Если нужен ретушь лица – 30–50. Для Flux Dev можно пробовать и меньше (15–25) – модель очень выразительна. Главное – выдержать баланс между скоростью и качеством (увеличение шагов даёт более чёткие детали, но и затраты растут).
 • ControlNet и расширения: Для большего реализма можно добавить ControlNet. Например, модели openPose, Depth или segmentation помогут задавать точную композицию и освещение сцены; Tile (ControlNet-Pix2Pix) можно использовать вместе с TiledDiffusion для повышения детализации без швов. IP-Adapter/AI-Refiner и аналогичные не дают выигрыш для случайных лиц. В качестве расширений полезны: ADetailer (описано выше), GFPGAN (восстановление лиц после генерации), Blind-Artist (для резкости).
 • LoRA weight: С весом LoRA следует экспериментировать. Часто используют значения 0.5–1.0. Если нужно сильнее проявить характеристики LoRA (например, лицо пользователя), можно поднять до ~1. При малом весе (~0.3) эффект слабый. Например, в одном совете для портрета рекомендовали LoRA Detail Enhancer 0.5, Detail Tweaker 0.15, Advanced Enhancer 1.0 . Для пользовательской LoRA-фотопортрета часто хватает 0.6–0.8.
 • Clip skip: Для Flux (как и для SD1.5) обычно достаточно стандартного skip=1 (то есть CLIP Skip 1, без пропуска слоёв). Специально менять Clip Skip для Flux не требуется . Если вы используете другие модели, руководствуйтесь их рекомендациями.
 • VAE: Используйте VAE, совместимый с вашей моделью. Для качественного фотостиля советуют VAE с ft-mse-840000 (стандартный для SD1.5) или DCVAE. Некоторые отмечают, что ft-mse-840000 даёт насыщенные цвета . Можно попробовать альтернативные VAEs (e.g. “AutoVAE” или “Openjourney VAE”) и оценить по итоговому цветопередачи. Главное – не смешивать VAE из несвязанных моделей.

Кастомные методы HiRes и апскейл-модели

Помимо встроенного HiRes.fix, в Forge/Flux доступны «кастомные» подходы к апскейлингу:
 • Ultimate SD Upscale (Comfy/UI) – мощный метод комбинированного апскейла, часто использующий внутренние картины Stable Diffusion. Пользователи отмечают, что Ultimate SD Upscaler (с дополнительными LoRA и ADetailer) делает качественный 4× апскейл без артефактов на границах . Например, рекомендуют модель “Ultimate SD Upscaler” (доступна через Comfy или как скрипт). Недостаток – иногда проявляются «швы» на простом фоне, особенно при масштабах ≥3× . Можно включить опцию «seams fix», но лучше не превышать 2.5× масштаб при этой технике.
 • Tiled Diffusion + Mixture of Diffusers – прогрессивный подход, где изображение разбивается на тайлы, в каждый из которых «вкладывается» SD инпейтинг (Mixture of Diffusers). Умельцы отмечают, что TiledDiffusion (с поддержкой Flux) полностью решает проблему швов: все тайлы сразу обрабатываются и усредняются, что даёт гладкую картинку . Workflow: сначала обычный апскейл (Lanczos или 4x-UltraSharp) до размеров, кратных 64, затем запускается TiledDiffusion с ControlNet-Tile или без него. По отзывам, TiledDiffusion+MoD даёт «чистый» результат без швов  . Недостаток – сложнее настраивать и требует больше VRAM.
 • Flux-dev ControlNet Upscaler (JasperAI Flux U-net) – специальная модель «Flux-dev-Upscaler» (ControlNet) от JasperAI, обученная для повышения разрешения и детализации портретов . Её можно подключить в качестве ControlNet-узла. Эта модель подчёркивает черты лица и текстуры, часто рекомендуют вес ControlNet ≈0.6 . Эффективна на зашумлённых фото, быстро придаёт чёткость.
 • Другие апскейлеры: в A1111 имеются SDR-аналог «Super Resolution 2.0» (Latent Diffusion Upscale), а также ESRGAN-модели (LDSR, PSNR). Однако для Flux лучше сочетать с вышеописанными техниками. Любой апскейлер (Lanczos, Nearest, 4x-UltraSharp) можно использовать как «предварительный» – например, сначала Lanczos→усреднение, потом Mixture of Diffusers.
 • Советы: при работе с нестандартными методами важно обеспечивать кратность размеров 64 (для MoD) . Также можно комбинировать: сначала обычный апскейл 2×, затем HiRes.fix или TiledDiffusion 1.5×. В Forge можно использовать скрипты или узлы (например, ComfyUI-флоу из pastebin  ) для автоматизации.

Таким образом, лучшие результаты у комбинированного подхода: HiRes.fix (GAN-апскейлер) + ADetailer + (при необходимости) TiledDiffusion/MixtureOfDiffusers. Основные рекомендованные инструменты: 4x-UltraSharp или R-ESRGAN, DPM++ 2M Karras, Denoise ~0.4, CFG для Flux=1  , а также опционально Flux U-net Upscaler от JasperAI  или Ultimate SD Upscaler.

Источники: обсуждения и эксперименты пользователей Stable Diffusion (см. цитаты      и др.), включая Reddit и GitHub.